import{d as Y,r as f,c as A,w as ne,S as ie,R as h,e as b,z as c,o,f as i,g as n,u as l,h as de,b as d,i as y,j as v,m as re,t as Q,B as k,k as ue,$ as j,C as _,x as ce,F as O,A as R,a as g,y as ve,D as pe,G as F,H as me,I as fe,J as W,v as X,K as he,L as _e,O as ge,P as we,Q as ye,_ as ke,V as Ce,W as be,X as Fe,Y as Ie}from"./_plugin-vue_export-helper-DfK-ff4r.js";const Ve={class:"create-folder-form"},$e={class:"header-section"},Ne={class:"action-buttons-section"},ze={class:"create-button-section"},xe={class:"middle-section"},Ae={key:0,class:"error-message"},Ee={class:"template-option"},qe={class:"template-name"},Pe={key:0,class:"template-description"},Te={key:0,class:"template-hint"},Me={class:"bottom-section"},Se={class:"file-panel selected-panel"},De={class:"panel-header"},Be={class:"panel-content"},Le={key:1,class:"file-list"},je={class:"file-info"},Oe={class:"file-path"},Re={key:0,class:"vault-name"},Ge={class:"file-panel search-panel"},Ue={class:"panel-header"},He={class:"panel-content"},Je={key:0,class:"loading-state"},Ke={key:2,class:"file-list"},Qe=["onClick"],We={class:"file-info"},Xe={class:"file-path"},Ye={key:0,class:"vault-name"},Ze=Y({__name:"CreateFolderForm",emits:["created","close"],setup(q,{emit:I}){const P=I,s=f({folderName:"",vaultId:"",templateId:""}),V=f(void 0),C=f([]),T=f([]),r=f([]),$=f([]),M=f(!1),S=f(!1),N=f(null),D=f(null),x=A(()=>T.value.filter(a=>a.type==="structure"));A(()=>C.value.find(a=>a.id===s.value.vaultId));const B=A(()=>{if(!s.value.folderName.trim())return $.value;const a=s.value.folderName.toLowerCase();return $.value.filter(e=>{var t;return e.name.toLowerCase().includes(a)||((t=e.title)==null?void 0:t.toLowerCase().includes(a))||e.path.toLowerCase().includes(a)})}),G=A(()=>s.value.folderName.trim()!==""&&s.value.vaultId!==""&&N.value===null);ne(()=>s.value.folderName,()=>{s.value.folderName.trim()&&H()},{deep:!0}),ie(()=>{if(window.initialData){const a=window.initialData;if(a.vaultId)s.value.vaultId=a.vaultId;else{h.error("无法获取 Vault 信息，请从 Vault 或文件夹节点右键创建"),setTimeout(()=>{window.acquireVsCodeApi&&window.acquireVsCodeApi().postMessage({method:"close"})},2e3);return}a.folderPath!==void 0&&(V.value=a.folderPath)}else{h.error("无法获取初始数据，请从 Vault 或文件夹节点右键创建"),setTimeout(()=>{window.acquireVsCodeApi&&window.acquireVsCodeApi().postMessage({method:"close"})},2e3);return}Z(),s.value.vaultId&&(ee(s.value.vaultId),U())});const Z=async()=>{try{const a=await b.call("vault.list",{});C.value=a||[]}catch(a){console.error("Failed to load vaults",a),C.value=[]}},ee=async a=>{try{const e=await b.call("template.list",{vaultId:a});T.value=e||[]}catch(e){console.error("Failed to load templates",e),h.error("加载模板失败: "+(e.message||"未知错误")),T.value=[]}},U=async()=>{try{M.value=!0;const a=[];if(C.value.length>0)for(const e of C.value)try{const t=await b.call("document.list",{vaultId:e.id});t&&a.push(...t)}catch(t){console.error(`Failed to load files from vault ${e.name}`,t)}try{const e=await b.call("workspace.listFiles",{});e&&a.push(...e)}catch(e){console.error("Failed to load workspace files",e)}$.value=a}catch(a){console.error("Failed to load files",a),$.value=[]}finally{M.value=!1}},te=()=>{N.value=J(s.value.folderName),H()},H=()=>{D.value!==null&&clearTimeout(D.value),D.value=window.setTimeout(()=>{s.value.folderName.trim()?U():$.value=[]},300)},J=a=>!a||a.trim().length===0?"文件夹名称不能为空":/[<>:"/\\|?*]/.test(a)?"文件夹名称包含非法字符":null,L=a=>r.value.some(e=>e.id&&e.id===a.id||e.path===a.path),ae=a=>{L(a)?K(a):r.value.push(a)},K=a=>{const e=r.value.findIndex(t=>t.id&&t.id===a.id||t.path===a.path);e>-1&&r.value.splice(e,1)},le=()=>{r.value=[]},se=async()=>{if(!G.value)return;const a=J(s.value.folderName);if(a){N.value=a,h.warning(a);return}try{S.value=!0;const e=V.value||"";let t=null;if(s.value.templateId&&x.value.find(u=>u.id===s.value.templateId))try{t=await b.call("template.getContent",{templateId:s.value.templateId,vaultId:s.value.vaultId})}catch(u){console.error("Failed to get template content",u)}const p=await b.call("document.createFolder",{vaultId:s.value.vaultId,folderPath:e,folderName:s.value.folderName.trim(),template:t});if(h.success("文件夹创建成功"),P("created",p),window.acquireVsCodeApi){const m=window.acquireVsCodeApi(),u=C.value.find(oe=>oe.id===s.value.vaultId),w=V.value||"";m.postMessage({method:"folderCreated",params:{vaultName:u==null?void 0:u.name,folderPath:w}})}setTimeout(()=>{window.acquireVsCodeApi&&window.acquireVsCodeApi().postMessage({method:"close"})},100)}catch(e){console.error("Failed to create folder",e),h.error(`创建文件夹失败: ${e.message||"未知错误"}`)}finally{S.value=!1}},z=a=>{if(r.value.length===0){h.warning("请先选择文件");return}const t={summarize:"总结",refactor:"重构",review:"检查",analyze:"分析",optimize:"优化"}[a]||a,p=r.value.map(w=>w.title||w.name).join("、"),m=r.value.map(w=>w.path).join(`
`);let u="";switch(a){case"summarize":u=`请总结以下文件的内容：

文件：${p}

路径：
${m}`;break;case"refactor":u=`请重构以下文件：

文件：${p}

路径：
${m}

请提供重构建议和优化方案。`;break;case"review":u=`请检查以下文件的代码质量和潜在问题：

文件：${p}

路径：
${m}

请提供代码审查意见。`;break;case"analyze":u=`请分析以下文件：

文件：${p}

路径：
${m}

请分析文件结构、依赖关系和设计模式。`;break;case"optimize":u=`请优化以下文件：

文件：${p}

路径：
${m}

请提供性能优化和代码优化建议。`;break;default:u=`${t}以下文件：

文件：${p}

路径：
${m}`}navigator.clipboard.writeText(u).then(()=>{h.success(`提示词已复制到剪贴板：${t}`)}).catch(w=>{console.error("Failed to copy to clipboard",w),h.error("复制到剪贴板失败")})};return(a,e)=>(o(),c("div",Ve,[i("div",$e,[i("div",Ne,[n(l(de),null,{default:d(()=>[n(l(y),{onClick:e[0]||(e[0]=t=>z("summarize")),disabled:r.value.length===0},{default:d(()=>[...e[7]||(e[7]=[v(" 总结 ",-1)])]),_:1},8,["disabled"]),n(l(y),{onClick:e[1]||(e[1]=t=>z("refactor")),disabled:r.value.length===0},{default:d(()=>[...e[8]||(e[8]=[v(" 重构 ",-1)])]),_:1},8,["disabled"]),n(l(y),{onClick:e[2]||(e[2]=t=>z("review")),disabled:r.value.length===0},{default:d(()=>[...e[9]||(e[9]=[v(" 检查 ",-1)])]),_:1},8,["disabled"]),n(l(y),{onClick:e[3]||(e[3]=t=>z("analyze")),disabled:r.value.length===0},{default:d(()=>[...e[10]||(e[10]=[v(" 分析 ",-1)])]),_:1},8,["disabled"]),n(l(y),{onClick:e[4]||(e[4]=t=>z("optimize")),disabled:r.value.length===0},{default:d(()=>[...e[11]||(e[11]=[v(" 优化 ",-1)])]),_:1},8,["disabled"])]),_:1})]),i("div",ze,[n(l(y),{type:"primary",onClick:se,loading:S.value,disabled:!G.value},{default:d(()=>[...e[12]||(e[12]=[v(" 创建文件夹 ",-1)])]),_:1},8,["loading","disabled"])])]),i("div",xe,[n(l(re),{model:s.value,"label-width":"100px","label-position":"left"},{default:d(()=>[n(l(Q),{label:"文件夹名称",required:!0},{label:d(()=>[...e[13]||(e[13]=[i("span",null,[v("文件夹名称"),i("span",{style:{color:"var(--vscode-inputValidation-errorForeground, #f14c4c)","margin-left":"4px"}},"*")],-1)])]),default:d(()=>[n(l(ue),{modelValue:s.value.folderName,"onUpdate:modelValue":e[5]||(e[5]=t=>s.value.folderName=t),placeholder:"输入文件夹名称（支持模糊搜索）",clearable:"",onInput:te,"prefix-icon":l(j)},null,8,["modelValue","prefix-icon"]),N.value?(o(),c("div",Ae,_(N.value),1)):k("",!0)]),_:1}),n(l(Q),{label:"文件夹模板"},{default:d(()=>[n(l(ce),{modelValue:s.value.templateId,"onUpdate:modelValue":e[6]||(e[6]=t=>s.value.templateId=t),placeholder:x.value.length===0?"暂无文件夹模板":"选择文件夹模板（可选）",filterable:"",clearable:"",style:{width:"100%"},disabled:!s.value.vaultId},{default:d(()=>[(o(!0),c(O,null,R(x.value,t=>(o(),g(l(ve),{key:t.id,label:t.name,value:t.id},{default:d(()=>[i("div",Ee,[i("span",qe,_(t.name),1),t.description?(o(),c("span",Pe,_(t.description),1)):k("",!0),n(l(pe),{type:"success",size:"small",style:{"margin-left":"8px"}},{default:d(()=>[...e[14]||(e[14]=[v(" 结构 ",-1)])]),_:1})])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","disabled"]),s.value.vaultId&&x.value.length===0?(o(),c("div",Te,[...e[15]||(e[15]=[i("span",{style:{"font-size":"12px",color:"var(--vscode-descriptionForeground, #999999)"}}," 当前 Vault 没有可用的文件夹模板（structure 类型） ",-1)])])):k("",!0)]),_:1})]),_:1},8,["model"])]),i("div",Me,[i("div",Se,[i("div",De,[i("h4",null,[n(l(F),null,{default:d(()=>[n(l(me))]),_:1}),v(" 已选择文件 ("+_(r.value.length)+") ",1)]),r.value.length>0?(o(),g(l(y),{key:0,type:"danger",size:"small",icon:l(fe),onClick:le},{default:d(()=>[...e[16]||(e[16]=[v(" 清空 ",-1)])]),_:1},8,["icon"])):k("",!0)]),i("div",Be,[r.value.length===0?(o(),g(l(W),{key:0,description:"暂无已选择文件","image-size":80})):(o(),c("div",Le,[(o(!0),c(O,null,R(r.value,t=>(o(),c("div",{key:t.id||t.path,class:"file-item selected"},[n(l(F),{class:"file-icon"},{default:d(()=>[t.type==="folder"?(o(),g(l(j),{key:0})):(o(),g(l(X),{key:1}))]),_:2},1024),i("div",je,[i("div",Oe,[t.vault?(o(),c("span",Re,_(t.vault.name)+"(vault): ",1)):k("",!0),v(_(t.path),1)])]),n(l(y),{type:"danger",icon:l(he),size:"small",circle:"",onClick:p=>K(t)},null,8,["icon","onClick"])]))),128))]))])]),i("div",Ge,[i("div",Ue,[i("h4",null,[n(l(F),null,{default:d(()=>[n(l(_e))]),_:1}),v(" 文件检索结果 ("+_(B.value.length)+") ",1)])]),i("div",He,[M.value?(o(),c("div",Je,[n(l(F),{class:"is-loading"},{default:d(()=>[n(l(ge))]),_:1}),e[17]||(e[17]=i("span",null,"加载中...",-1))])):B.value.length===0?(o(),g(l(W),{key:1,description:"没有找到匹配的文件","image-size":80})):(o(),c("div",Ke,[(o(!0),c(O,null,R(B.value,t=>(o(),c("div",{key:t.id||t.path,class:we(["file-item",{"is-selected":L(t)}]),onClick:p=>ae(t)},[n(l(F),{class:"file-icon"},{default:d(()=>[t.type==="folder"?(o(),g(l(j),{key:0})):(o(),g(l(X),{key:1}))]),_:2},1024),i("div",We,[i("div",Xe,[t.vault?(o(),c("span",Ye,_(t.vault.name)+"(vault): ",1)):k("",!0),v(_(t.path),1)])]),L(t)?(o(),g(l(F),{key:0,class:"check-icon"},{default:d(()=>[n(l(ye))]),_:1})):k("",!0)],10,Qe))),128))]))])])])]))}}),et=ke(Ze,[["__scopeId","data-v-4f3c5484"]]),tt={id:"create-folder-dialog-page"},at=Y({__name:"CreateFolderDialogPage",setup(q){const I=s=>{console.log("Folder created:",s),window.acquireVsCodeApi&&window.acquireVsCodeApi().postMessage({method:"close"})},P=()=>{window.acquireVsCodeApi&&window.acquireVsCodeApi().postMessage({method:"close"})};return(s,V)=>(o(),c("div",tt,[n(et,{onCreated:I,onClose:P})]))}}),E=Ce(at),lt=be();E.use(Fe);for(const[q,I]of Object.entries(Ie))E.component(q,I);E.use(lt);E.mount("#app");
