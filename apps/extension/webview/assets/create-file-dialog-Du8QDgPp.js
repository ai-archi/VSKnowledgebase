import{d as X,r as p,c as J,w as oe,S as ie,e as w,Z as ne,z as c,o as u,f as d,g as s,b as i,u as t,i as _,j as v,m as de,t as L,k as ue,v as B,n as re,q as K,x as Q,y as V,F as j,A as R,a as y,B as N,C as m,D as ce,G as k,H as ve,I as pe,J as W,K as me,L as fe,O as _e,P as he,$ as ye,Q as ge,R as z,_ as we,V as ke,W as be,X as Ce,Y as $e}from"./_plugin-vue_export-helper-DfK-ff4r.js";const Fe={class:"create-file-form"},Ie={class:"header-section"},Ve={class:"action-buttons-section"},Ne={class:"create-button-section"},ze={class:"middle-section"},Ee={class:"template-option"},Te={class:"template-name"},xe={key:0,class:"template-description"},Pe={class:"bottom-section"},Ae={class:"file-panel selected-panel"},De={class:"panel-header"},Se={class:"panel-content"},qe={key:1,class:"file-list"},Me={class:"file-info"},Le={class:"file-path"},Be={key:0,class:"vault-name"},je={class:"file-panel search-panel"},Re={class:"panel-header"},Oe={class:"panel-content"},Ue={key:0,class:"loading-state"},Ge={key:2,class:"file-list"},He=["onClick"],Je={class:"file-info"},Ke={class:"file-path"},Qe={key:0,class:"vault-name"},We=X({__name:"CreateFileForm",emits:["created","close"],setup(x,{emit:b}){const P=b,o=p({fileName:"",fileType:"document",vaultId:"",templateId:""}),C=p(void 0),E=p([]),$=p([]),r=p([]),F=p([]),A=p(!1),D=p(!1),S=p(null),q=J(()=>{if(!o.value.fileName.trim())return F.value;const a=o.value.fileName.toLowerCase();return F.value.filter(e=>{var n;return e.name.toLowerCase().includes(a)||((n=e.title)==null?void 0:n.toLowerCase().includes(a))||e.path.toLowerCase().includes(a)})}),O=J(()=>o.value.fileName.trim()!==""&&o.value.fileType!==""&&o.value.vaultId!=="");oe(()=>[o.value.fileName],()=>{o.value.fileName.trim()&&G()},{deep:!0}),ie(()=>{if(window.initialData){const a=window.initialData;a.vaultId&&(o.value.vaultId=a.vaultId),a.folderPath&&(C.value=a.folderPath)}Y(),o.value.vaultId&&(Z(o.value.vaultId),U())});const Y=async()=>{try{const a=await w.call("vault.list",{});E.value=a||[]}catch(a){console.error("Failed to load vaults",a),E.value=[]}},Z=async a=>{try{const e=await w.call("template.list",{vaultId:a});$.value=e||[]}catch(e){console.error("Failed to load templates",e),$.value=[]}},U=async()=>{try{A.value=!0;const a=[];if(E.value.length>0)for(const e of E.value)try{const n=await w.call("document.list",{vaultId:e.id});n&&a.push(...n)}catch(n){console.error(`Failed to load files from vault ${e.name}`,n)}try{const e=await w.call("workspace.listFiles",{});e&&a.push(...e)}catch(e){console.error("Failed to load workspace files",e)}F.value=a}catch(a){console.error("Failed to load files",a),F.value=[]}finally{A.value=!1}},ee=()=>{G()},G=()=>{S.value!==null&&clearTimeout(S.value),S.value=window.setTimeout(()=>{o.value.fileName.trim()?U():F.value=[]},300)},M=a=>r.value.some(e=>e.id&&e.id===a.id||e.path===a.path),ae=a=>{M(a)?H(a):r.value.push(a)},H=a=>{const e=r.value.findIndex(n=>n.id&&n.id===a.id||n.path===a.path);e>-1&&r.value.splice(e,1)},le=()=>{r.value=[]},te=async()=>{if(O.value)try{D.value=!0;let a=`${o.value.fileType}/${o.value.fileName}.md`;C.value&&(a=`${C.value}/${a}`);const e=await w.call("document.create",{vaultId:o.value.vaultId,path:a,title:o.value.fileName,content:o.value.templateId?await se(o.value.templateId):`# ${o.value.fileName.trim()}

`});z.success("文件创建成功"),P("created",e),window.acquireVsCodeApi&&window.acquireVsCodeApi().postMessage({method:"close"})}catch(a){console.error("Failed to create document",a),z.error(`创建文件失败: ${a.message||"未知错误"}`)}finally{D.value=!1}},se=async a=>{try{if($.value.find(n=>n.id===a))return await w.call("template.getContent",{templateId:a,vaultId:o.value.vaultId})||""}catch(e){console.error("Failed to get template content",e)}return""},I=a=>{if(r.value.length===0){z.warning("请先选择文件");return}const n={summarize:"总结",refactor:"重构",review:"检查",analyze:"分析",optimize:"优化"}[a]||a,l=r.value.map(g=>g.title||g.name).join("、"),f=r.value.map(g=>g.path).join(`
`);let h="";switch(a){case"summarize":h=`请总结以下文件的内容：

文件：${l}

路径：
${f}`;break;case"refactor":h=`请重构以下文件：

文件：${l}

路径：
${f}

请提供重构建议和优化方案。`;break;case"review":h=`请检查以下文件的代码质量和潜在问题：

文件：${l}

路径：
${f}

请提供代码审查意见。`;break;case"analyze":h=`请分析以下文件：

文件：${l}

路径：
${f}

请分析文件结构、依赖关系和设计模式。`;break;case"optimize":h=`请优化以下文件：

文件：${l}

路径：
${f}

请提供性能优化和代码优化建议。`;break;default:h=`${n}以下文件：

文件：${l}

路径：
${f}`}navigator.clipboard.writeText(h).then(()=>{z.success(`提示词已复制到剪贴板：${n}`)}).catch(g=>{console.error("Failed to copy to clipboard",g),z.error("复制到剪贴板失败")})};return(a,e)=>{const n=ne("el-button-group");return u(),c("div",Fe,[d("div",Ie,[d("div",Ve,[s(n,null,{default:i(()=>[s(t(_),{onClick:e[0]||(e[0]=l=>I("summarize")),disabled:r.value.length===0},{default:i(()=>[...e[8]||(e[8]=[v(" 总结 ",-1)])]),_:1},8,["disabled"]),s(t(_),{onClick:e[1]||(e[1]=l=>I("refactor")),disabled:r.value.length===0},{default:i(()=>[...e[9]||(e[9]=[v(" 重构 ",-1)])]),_:1},8,["disabled"]),s(t(_),{onClick:e[2]||(e[2]=l=>I("review")),disabled:r.value.length===0},{default:i(()=>[...e[10]||(e[10]=[v(" 检查 ",-1)])]),_:1},8,["disabled"]),s(t(_),{onClick:e[3]||(e[3]=l=>I("analyze")),disabled:r.value.length===0},{default:i(()=>[...e[11]||(e[11]=[v(" 分析 ",-1)])]),_:1},8,["disabled"]),s(t(_),{onClick:e[4]||(e[4]=l=>I("optimize")),disabled:r.value.length===0},{default:i(()=>[...e[12]||(e[12]=[v(" 优化 ",-1)])]),_:1},8,["disabled"])]),_:1})]),d("div",Ne,[s(t(_),{type:"primary",onClick:te,loading:D.value,disabled:!O.value},{default:i(()=>[...e[13]||(e[13]=[v(" 创建文件 ",-1)])]),_:1},8,["loading","disabled"])])]),d("div",ze,[s(t(de),{model:o.value,"label-width":"100px","label-position":"left"},{default:i(()=>[s(t(L),{label:"文件名"},{default:i(()=>[s(t(ue),{modelValue:o.value.fileName,"onUpdate:modelValue":e[5]||(e[5]=l=>o.value.fileName=l),placeholder:"输入文件名（支持模糊搜索）",clearable:"",onInput:ee,"prefix-icon":t(B)},null,8,["modelValue","prefix-icon"])]),_:1}),s(t(re),{gutter:20},{default:i(()=>[s(t(K),{span:12},{default:i(()=>[s(t(L),{label:"文件类型"},{default:i(()=>[s(t(Q),{modelValue:o.value.fileType,"onUpdate:modelValue":e[6]||(e[6]=l=>o.value.fileType=l),placeholder:"选择文件类型",clearable:"",style:{width:"100%"}},{default:i(()=>[s(t(V),{label:"文档 (Markdown)",value:"document"}),s(t(V),{label:"任务 (Task)",value:"task"}),s(t(V),{label:"设计图 (Diagram)",value:"diagram"}),s(t(V),{label:"模板 (Template)",value:"template"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),s(t(K),{span:12},{default:i(()=>[s(t(L),{label:"文件模板"},{default:i(()=>[s(t(Q),{modelValue:o.value.templateId,"onUpdate:modelValue":e[7]||(e[7]=l=>o.value.templateId=l),placeholder:"选择模板（可选）",filterable:"",clearable:"",style:{width:"100%"},disabled:!o.value.vaultId||$.value.length===0},{default:i(()=>[(u(!0),c(j,null,R($.value,l=>(u(),y(t(V),{key:l.id,label:l.name,value:l.id},{default:i(()=>[d("div",Ee,[d("span",Te,m(l.name),1),l.description?(u(),c("span",xe,m(l.description),1)):N("",!0),s(t(ce),{type:l.type==="structure"?"success":"info",size:"small",style:{"margin-left":"8px"}},{default:i(()=>[v(m(l.type==="structure"?"结构":"内容"),1)]),_:2},1032,["type"])])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),d("div",Pe,[d("div",Ae,[d("div",De,[d("h4",null,[s(t(k),null,{default:i(()=>[s(t(ve))]),_:1}),v(" 已选择文件 ("+m(r.value.length)+") ",1)]),r.value.length>0?(u(),y(t(_),{key:0,type:"danger",size:"small",icon:t(pe),onClick:le},{default:i(()=>[...e[14]||(e[14]=[v(" 清空 ",-1)])]),_:1},8,["icon"])):N("",!0)]),d("div",Se,[r.value.length===0?(u(),y(t(W),{key:0,description:"暂无已选择文件","image-size":80})):(u(),c("div",qe,[(u(!0),c(j,null,R(r.value,l=>(u(),c("div",{key:l.id||l.path,class:"file-item selected"},[s(t(k),{class:"file-icon"},{default:i(()=>[s(t(B))]),_:1}),d("div",Me,[d("div",Le,[l.vault?(u(),c("span",Be,m(l.vault.name)+"(vault): ",1)):N("",!0),v(m(l.path),1)])]),s(t(_),{type:"danger",icon:t(me),size:"small",circle:"",onClick:f=>H(l)},null,8,["icon","onClick"])]))),128))]))])]),d("div",je,[d("div",Re,[d("h4",null,[s(t(k),null,{default:i(()=>[s(t(fe))]),_:1}),v(" 文件检索结果 ("+m(q.value.length)+") ",1)])]),d("div",Oe,[A.value?(u(),c("div",Ue,[s(t(k),{class:"is-loading"},{default:i(()=>[s(t(_e))]),_:1}),e[15]||(e[15]=d("span",null,"加载中...",-1))])):q.value.length===0?(u(),y(t(W),{key:1,description:"没有找到匹配的文件","image-size":80})):(u(),c("div",Ge,[(u(!0),c(j,null,R(q.value,l=>(u(),c("div",{key:l.id||l.path,class:he(["file-item",{"is-selected":M(l)}]),onClick:f=>ae(l)},[s(t(k),{class:"file-icon"},{default:i(()=>[l.type==="folder"?(u(),y(t(ye),{key:0})):(u(),y(t(B),{key:1}))]),_:2},1024),d("div",Je,[d("div",Ke,[l.vault?(u(),c("span",Qe,m(l.vault.name)+"(vault): ",1)):N("",!0),v(m(l.path),1)])]),M(l)?(u(),y(t(k),{key:0,class:"check-icon"},{default:i(()=>[s(t(ge))]),_:1})):N("",!0)],10,He))),128))]))])])])])}}}),Xe=we(We,[["__scopeId","data-v-239f77fe"]]),Ye={id:"create-file-dialog-page"},Ze=X({__name:"CreateFileDialogPage",setup(x){const b=o=>{console.log("File created:",o),window.acquireVsCodeApi&&window.acquireVsCodeApi().postMessage({method:"close"})},P=()=>{window.acquireVsCodeApi&&window.acquireVsCodeApi().postMessage({method:"close"})};return(o,C)=>(u(),c("div",Ye,[s(Xe,{onCreated:b,onClose:P})]))}}),T=ke(Ze),ea=be();T.use(Ce);for(const[x,b]of Object.entries($e))T.component(x,b);T.use(ea);T.mount("#app");
