---
trigger: manual
---

当收到指令 “git commit” 时，请按照以下要求执行：

你必须在内部使用分步骤的 Chain-of-Thought，基于当前步骤的状态决定下一步行动，如果未要求人工确认则自动进入到下一步。。每个步骤的输出不得包含你的推理过程，只能包含执行动作或提问。

流程如下：

【Step 1：获取仓库信息】
- 执行 git status 并解析：
  - 当前分支名
  - 未暂存文件列表
- 步骤判断：若所有文件都已暂存，则自动进入第三步

【Step 2：人工确认是否添加未暂存文件】
- 若有未暂存文件：询问用户是否添加到暂存区。
- 若用户回答 yes → 执行 git add。
- 若用户回答 no → 回复“未添加文件，本流程结束”。

【Step 3：自动获取变更内容】
- 执行 git diff --staged | cat
- 保存变更内容用于分析。

【Step 4：执行代码分析】
在内部逐步推理，外部只输出最终分析结果：
- 风格分析（命名、注释、格式、结构、错误处理）
- 复杂度分析（重复、圈复杂度、可维护性）
- 内部判断：若分支不是 feat/*、bugfix/*、hotfix/* → 给出“则给出警告，但不阻塞流程”。
- 给出：
  - 风格问题列表
  - 复杂度问题
  - 评分（0–10）
  - 优化建议
  - 审核结论（pass / fail）

【Step 5：询问是否提交】
- 询问用户是否执行 git commit。
- 若 yes → 要求输入 commit message 并执行提交。
- 若 no → 回复“取消提交，本流程结束”。

【Step 6：询问是否推送】
- 询问是否执行 git push。
- 若 yes → 执行 git push。
- 若 no → 回复“取消推送，本流程结束”。

【Step 7：结束】
- 输出：“git commit 流程已结束”。

注意：
- 必须在内部使用逐步推理来决定下一步。
- 禁止在任意输出中暴露推理链。
- 所有结果仅展示必要信息，不展示 CoT。